<html>
<body>
<head>
<script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAA16Es4vVKB3LR3KqSzgmFgBQSrYE7M2jFIn0ilamqd471pr_vwhSJD83yoTDES8fAIy4Uo867U3tirQ"></script>

<script type="text/javascript" src="/static/rapidsuivi/js/gmap/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="/static/rapidsuivi/js/gmap/jquery.gmap-1.1.0-min.js"></script>
<style type ='text/css'>
   
</style>
</head>

<body >
<!--script src="http://maps.google.com/maps?file=api&key=" type="text/javascript"></script-->
<script src="/static/rapidsuivi/js/gmap/labeledmarker.js" type="text/javascript"></script>
<script type="text/javascript">
$(function() {
	    //
	    {% for village in villages %}
			alert ("{{ village.gmap_latitude  }} ++ {{ village.gmap_longitude }} ++ {{ village.name }}  ++ {{ village.new_message}}");  
	    {% endfor %}
	    
	   
	    //
        var gm = google.maps;
        if(gm.BrowserIsCompatible()) {
                var INITIAL_ZOOM = 7;
                /* initialize the map with the full
                * map-type, zoom, and pan controls */
                var map = new gm.Map2($("#map").get(0));
                map.addControl(new gm.LargeMapControl());
                map.addControl(new gm.MapTypeControl());
                map.disableDoubleClickZoom();
                /* when the document is unloaded, allow the gmap
                * to release it's resoures (especially for IE6) */
                $(document.body).unload(function() {
                        google.maps.Unload();
                });

                /* we're adding a new location, so center
                * the map over... guatemala! (what?) */
                var lat = 14.497401;
                var lon = -14.452362;
                var latlon = new gm.LatLng(lat, lon);
                map.setCenter(latlon, INITIAL_ZOOM);
				/*
 	            var sprite = function(offset) {
                        var icon = new GIcon(G_DEFAULT_ICON);
                        icon.sprite = {
		                "image": "/static/locations/images/markers.png",
		                "top": offset * 34
				};
		        return icon;
                };
				*/
                var sprite2 = function (new_message){
						var icon = new GIcon (G_DEFAULT_ICON)
						if (new_message =="true"){
							icon.sprite ={"image": "/static/locations/images/markers.png"}
						}
						else {
							icon.sprite ={"image": "/static/locations/images/markers.png"}
						}
               }
                /* iterate each of the markers (ALL locations),
                * and add a sprite to the map for each one */
				{%  for village    in villages  %} 
	                    var point = new GLatLng("{{ village.latitute }}","{{ village.longitude }}");
			            var marker = new LabeledMarker(point, 
						    { "labelText": "{{ village.name }}",
							  "labelClass": "caption", 
						   	  "icon": sprite2("{{village.new_message}}") 	
						    });
				        marker.bindInfoWindow("<div>{{ village.message }}</div>");
			            map.addOverlay(marker);
			    {% endfor %}
        }
});
</script>

<div id="map">
    &nbsp;
</div>

